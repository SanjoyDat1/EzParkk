[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

# Rewrite rules for static HTML files
[[redirects]]
  from = "/verify-email"
  to = "/verify-email.html"
  status = 200

# CSP headers are set in next.config.js
# Removed CSP from netlify.toml to avoid conflicts - Next.js headers take precedence
# [[headers]]
#   for = "/*"
#   [headers.values]
#     Content-Security-Policy = "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; script-src 'self' 'unsafe-eval' 'unsafe-inline' https: http: data: blob:; connect-src 'self' https: http: ws: wss:; style-src 'self' 'unsafe-inline' https:; img-src 'self' blob: data: https: http:; font-src 'self' data: https:;"
